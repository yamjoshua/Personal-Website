{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CustomGallery = void 0;\n\nvar photoswipe_1 = __importDefault(require(\"photoswipe\"));\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\n\nvar helpers_1 = require(\"./helpers\");\n\nvar context_1 = require(\"./context\");\n\nvar gallery_base_1 = require(\"./gallery-base\");\n/**\n * Gallery component with ability to use specific UI and Layout\n */\n\n\nvar CustomGallery = function (_a) {\n  var children = _a.children,\n      layoutRef = _a.layoutRef,\n      ui = _a.ui,\n      options = _a.options,\n      galleryUID = _a.id,\n      onOpen = _a.onOpen;\n  var items = react_1.useRef(new Map());\n  var openWhenReadyPid = react_1.useRef(null);\n  var open = react_1.useCallback(function (targetRef, targetId, itemIndex) {\n    var index = itemIndex || null;\n    var normalized = [];\n    var entries = Array.from(items.current);\n\n    var prepare = function (entry, i) {\n      var _a = __read(entry, 2),\n          ref = _a[0],\n          _b = _a[1],\n          width = _b.width,\n          height = _b.height,\n          title = _b.title,\n          original = _b.original,\n          thumbnail = _b.thumbnail,\n          pid = _b.id,\n          rest = __rest(_b, [\"width\", \"height\", \"title\", \"original\", \"thumbnail\", \"id\"]);\n\n      if (targetRef === ref || pid !== undefined && String(pid) === targetId) {\n        index = i;\n      }\n\n      normalized.push(__assign(__assign(__assign(__assign({}, title ? {\n        title: title\n      } : {}), {\n        w: Number(width),\n        h: Number(height),\n        src: original,\n        msrc: thumbnail,\n        el: ref.current\n      }), pid !== undefined ? {\n        pid: pid\n      } : {}), rest));\n    };\n\n    if (items.current.size > 1) {\n      entries.sort(function (_a, _b) {\n        var _c = __read(_a, 1),\n            a = _c[0].current;\n\n        var _d = __read(_b, 1),\n            b = _d[0].current;\n\n        return helpers_1.sortNodes(a, b);\n      }).forEach(prepare);\n    } else {\n      entries.forEach(prepare);\n    }\n\n    var layoutEl = layoutRef.current;\n\n    if (layoutEl) {\n      var instance = new photoswipe_1.default(layoutEl, ui, normalized, __assign(__assign({\n        index: index === null ? parseInt(targetId, 10) - 1 : index,\n        getThumbBoundsFn: function (thumbIndex) {\n          var el = normalized[thumbIndex].el;\n          return el ? helpers_1.getElBounds(el) : {\n            x: 0,\n            y: 0,\n            w: 0\n          };\n        },\n        history: false\n      }, galleryUID !== undefined ? {\n        galleryUID: galleryUID,\n        history: true\n      } : {}), options || {}));\n      instance.init();\n\n      if (onOpen !== undefined && typeof onOpen === 'function') {\n        onOpen(instance);\n      }\n    }\n  }, [options, galleryUID, onOpen]);\n  react_1.useEffect(function () {\n    if (galleryUID === undefined) {\n      return;\n    }\n\n    var hash = window.location.hash.substring(1);\n    var params = {};\n\n    if (hash.length < 5) {\n      return;\n    }\n\n    var vars = hash.split('&');\n\n    for (var i = 0; i < vars.length; i++) {\n      if (vars[i]) {\n        var _a = __read(vars[i].split('='), 2),\n            key = _a[0],\n            value = _a[1];\n\n        if (key && value) {\n          params[key] = value;\n        }\n      }\n    }\n\n    var pid = params.pid,\n        gid = params.gid;\n\n    if (items.current.size === 0) {\n      openWhenReadyPid.current = pid;\n      return;\n    }\n\n    if (pid && gid === String(galleryUID)) {\n      open(null, pid);\n    }\n  }, [open, galleryUID]);\n  var remove = react_1.useCallback(function (ref) {\n    items.current.delete(ref);\n  }, []);\n  var set = react_1.useCallback(function (ref, data) {\n    var id = data.id;\n    items.current.set(ref, data);\n    if (!openWhenReadyPid.current) return;\n\n    if (id === openWhenReadyPid.current) {\n      open(ref);\n      openWhenReadyPid.current = null;\n    } else if (!id) {\n      var index = parseInt(openWhenReadyPid.current, 10) - 1;\n      var refToOpen = Array.from(items.current.keys())[index];\n\n      if (refToOpen) {\n        open(refToOpen);\n        openWhenReadyPid.current = null;\n      }\n    }\n  }, [open]);\n  var openAt = react_1.useCallback(function (index) {\n    open(null, null, index);\n  }, [open]);\n  return react_1.default.createElement(context_1.Context.Provider, {\n    value: {\n      remove: remove,\n      set: set,\n      handleClick: open,\n      open: openAt\n    }\n  }, children);\n};\n\nexports.CustomGallery = CustomGallery;\nexports.CustomGallery.propTypes = __assign(__assign({}, gallery_base_1.baseGalleryPropTypes), {\n  // @ts-ignore\n  layoutRef: prop_types_1.default.shape({\n    current: prop_types_1.default.instanceOf(typeof Element === 'undefined' ?\n    /** @class */\n    function () {\n      function Element() {}\n\n      return Element;\n    }() : Element)\n  }).isRequired,\n  ui: prop_types_1.default.any.isRequired\n});","map":{"version":3,"sources":["../src/gallery-custom.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CustomGallery = void 0;\nvar photoswipe_1 = __importDefault(require(\"photoswipe\"));\nvar react_1 = __importStar(require(\"react\"));\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\nvar helpers_1 = require(\"./helpers\");\nvar context_1 = require(\"./context\");\nvar gallery_base_1 = require(\"./gallery-base\");\n/**\n * Gallery component with ability to use specific UI and Layout\n */\nvar CustomGallery = function (_a) {\n    var children = _a.children, layoutRef = _a.layoutRef, ui = _a.ui, options = _a.options, galleryUID = _a.id, onOpen = _a.onOpen;\n    var items = react_1.useRef(new Map());\n    var openWhenReadyPid = react_1.useRef(null);\n    var open = react_1.useCallback(function (targetRef, targetId, itemIndex) {\n        var index = itemIndex || null;\n        var normalized = [];\n        var entries = Array.from(items.current);\n        var prepare = function (entry, i) {\n            var _a = __read(entry, 2), ref = _a[0], _b = _a[1], width = _b.width, height = _b.height, title = _b.title, original = _b.original, thumbnail = _b.thumbnail, pid = _b.id, rest = __rest(_b, [\"width\", \"height\", \"title\", \"original\", \"thumbnail\", \"id\"]);\n            if (targetRef === ref ||\n                (pid !== undefined && String(pid) === targetId)) {\n                index = i;\n            }\n            normalized.push(__assign(__assign(__assign(__assign({}, (title ? { title: title } : {})), { w: Number(width), h: Number(height), src: original, msrc: thumbnail, el: ref.current }), (pid !== undefined ? { pid: pid } : {})), rest));\n        };\n        if (items.current.size > 1) {\n            entries\n                .sort(function (_a, _b) {\n                var _c = __read(_a, 1), a = _c[0].current;\n                var _d = __read(_b, 1), b = _d[0].current;\n                return helpers_1.sortNodes(a, b);\n            })\n                .forEach(prepare);\n        }\n        else {\n            entries.forEach(prepare);\n        }\n        var layoutEl = layoutRef.current;\n        if (layoutEl) {\n            var instance = new photoswipe_1.default(layoutEl, ui, normalized, __assign(__assign({ index: index === null ? parseInt(targetId, 10) - 1 : index, getThumbBoundsFn: function (thumbIndex) {\n                    var el = normalized[thumbIndex].el;\n                    return el ? helpers_1.getElBounds(el) : { x: 0, y: 0, w: 0 };\n                }, history: false }, (galleryUID !== undefined\n                ? { galleryUID: galleryUID, history: true }\n                : {})), (options || {})));\n            instance.init();\n            if (onOpen !== undefined && typeof onOpen === 'function') {\n                onOpen(instance);\n            }\n        }\n    }, [options, galleryUID, onOpen]);\n    react_1.useEffect(function () {\n        if (galleryUID === undefined) {\n            return;\n        }\n        var hash = window.location.hash.substring(1);\n        var params = {};\n        if (hash.length < 5) {\n            return;\n        }\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n            if (vars[i]) {\n                var _a = __read(vars[i].split('='), 2), key = _a[0], value = _a[1];\n                if (key && value) {\n                    params[key] = value;\n                }\n            }\n        }\n        var pid = params.pid, gid = params.gid;\n        if (items.current.size === 0) {\n            openWhenReadyPid.current = pid;\n            return;\n        }\n        if (pid && gid === String(galleryUID)) {\n            open(null, pid);\n        }\n    }, [open, galleryUID]);\n    var remove = react_1.useCallback(function (ref) {\n        items.current.delete(ref);\n    }, []);\n    var set = react_1.useCallback(function (ref, data) {\n        var id = data.id;\n        items.current.set(ref, data);\n        if (!openWhenReadyPid.current)\n            return;\n        if (id === openWhenReadyPid.current) {\n            open(ref);\n            openWhenReadyPid.current = null;\n        }\n        else if (!id) {\n            var index = parseInt(openWhenReadyPid.current, 10) - 1;\n            var refToOpen = Array.from(items.current.keys())[index];\n            if (refToOpen) {\n                open(refToOpen);\n                openWhenReadyPid.current = null;\n            }\n        }\n    }, [open]);\n    var openAt = react_1.useCallback(function (index) {\n        open(null, null, index);\n    }, [open]);\n    return (react_1.default.createElement(context_1.Context.Provider, { value: { remove: remove, set: set, handleClick: open, open: openAt } }, children));\n};\nexports.CustomGallery = CustomGallery;\nexports.CustomGallery.propTypes = __assign(__assign({}, gallery_base_1.baseGalleryPropTypes), { \n    // @ts-ignore\n    layoutRef: prop_types_1.default.shape({\n        current: prop_types_1.default.instanceOf(typeof Element === 'undefined' ? /** @class */ (function () {\n            function Element() {\n            }\n            return Element;\n        }()) : Element),\n    }).isRequired, ui: prop_types_1.default.any.isRequired });\n//# sourceMappingURL=gallery-custom.js.map"]},"metadata":{},"sourceType":"script"}